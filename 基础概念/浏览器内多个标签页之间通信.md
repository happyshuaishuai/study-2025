## 如何实现浏览器内多个标签页之间的通信?

浏览器内多个标签页之间可以通过以下几种方式进行通信：

### 1. `localStorage` + `storage` 事件
// 同源前提，协议，域名，端口相同

当一个标签页修改 `localStorage` 时，其他标签页会收到 `storage` 事件。

```js
// 发送消息
localStorage.setItem('message', 'Hello from another tab');

// 接收消息
window.addEventListener('storage', function(event) {
    if (event.key === 'message') {
        console.log('收到消息:', event.newValue);
    }
});
```

### 2. `BroadcastChannel` 广播通讯

`BroadcastChannel` 可以让同源的多个标签页直接通信。

下面是一个简单的 `BroadcastChannel` 封装示例：

```js
class TabChannel {
    constructor(channelName, onMessage) {
        this.channel = new BroadcastChannel(channelName);
        if (onMessage) {
            this.channel.onmessage = (event) => onMessage(event.data);
        }
    }

    send(data) {
        this.channel.postMessage(data);
    }

    close() {
        this.channel.close();
    }
}

// 使用示例
const channel = new TabChannel('my_channel', (msg) => {
    console.log('收到消息:', msg);
});

// 发送消息
channel.send('Hello tabs!');
```



### 3. `SharedWorker`

多个标签页可以通过 `SharedWorker` 共享同一个 worker 实例，实现通信。

```js
// worker.js
onconnect = function(e) {
    const port = e.ports[0];
    port.onmessage = function(event) {
        port.postMessage('收到: ' + event.data);
    };
};

// 主页面
const worker = new SharedWorker('worker.js');
//pageA
worker.port.postMessage('Hello from tab');
//pageB
worker.port.onmessage = function(event) {
    console.log(event.data);
};
```

### 4. `WebSocket`

通过 WebSocket，可以让多个标签页与服务器保持连接，由服务器进行消息分发，实现标签页间通信。

```js
// 使用 Node.js 创建 WebSocket 服务器（server.js）
const WebSocket = require('ws');
const wss = new WebSocket.Server({ port: 8080 });

wss.on('connection', function connection(ws) {
    ws.on('message', function incoming(message) {
        // 广播消息给所有连接的客户端
        wss.clients.forEach(function each(client) {
            if (client.readyState === WebSocket.OPEN) {
                client.send(message);
            }
        });
    });
});


// pageA发送消息
ws.send('Hello from tab');

// pageB接收消息
ws.onmessage = function(event) {
    console.log('收到消息:', event.data);
};
```

